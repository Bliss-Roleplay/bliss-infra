- name: Get all defined {{ container }} rule subjects
  set_fact:
    authelia_subjects: "{{ authelia_subjects | default([]) + item.authelia_rules | selectattr('subject', 'defined') | map(attribute='subject') }}"
  loop: "{{ container_authelia_rules }}"
  when: item.authelia_rules is defined and item.authelia_rules | selectattr('subject', 'defined') | length > 0

- name: Get all defined groups from {{ container }} rule subjects
  set_fact:
    authelia_groups: "{{ authelia_subjects | flatten | select('match', 'group:.*') | map('regex_replace', '(group:)', '') | unique }}"

# - include_tasks: containers/network/lldap/get_lldap_existing_groups.yml

# - debug:
#     var: lldap_groups_existing

# - name: Create LLDAP groups
#   include_tasks: containers/network/lldap/add_lldap_group.yml
#   loop: "{{ authelia_groups | unique }}"
#   loop_control:
#     loop_var: lldap_group
